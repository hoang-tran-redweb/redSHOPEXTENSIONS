redSHOP=window.redSHOP||{};redSHOP.postDanmark={};redSHOP.postDanmark.isMobile=(screen.width<=480);var google,service_points;(function(a,b){b(document).ready(function(){redSHOP.postDanmark.useMap=(Boolean(parseInt(redSHOP.RSConfig._("USEMAP")))&&!redSHOP.postDanmark.isMobile);var d=b('input[value="postdanmark_postdanmark"]');if(d.attr("checked")==="checked"||d.attr("type")=="hidden"){inject_button(b('input[value="postdanmark_postdanmark"]').parent().parent())}b('input[type="radio"]').each(function(e,f){if(checkPDinput(b(f))&&b(f).attr("checked")&&b("#showMap_input").length===0){inject_button(b(f))}});b('input[type="radio"][id^="shipping_rate_id"]').click(function(){if(checkPDinput(b(this))){inject_button(b(this))}else{b("#showMap_input, #sp_info, #sp_inputs, #showMap, #postdanmark_html_inject").remove()}});var c=b("body");c.on("click",".moduleRowSelected",function(f){if(b('input[value="postdanmark_postdanmark"]',b(this)).length>0){if(b("#showMap_input").length===0){inject_button(b(this))}}else{b("#showMap_input, #sp_info, #showMap, #sp_inputs, #thickbox-css, .pn_error").remove()}});b("body").on("click",'input[name="checkoutnext"], input[name="checkout_final"]',function(f){b(".pn_error").remove();if(validate_postdanmark()){b("form#adminForm").submit()}else{b("#sp_info").after('<div class="pn_error" style="color: red; font-weight: normal; ">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_PRESS_POINT_TO_DELIVERY")+"</div>");f.preventDefault()}});c.on("click",".map-button-save",function(){b(".pn_error").remove();if(!b('input[name="postdanmark_pickupLocation"]').is(":checked")){if(b("#error_checked_radio").length===0){b(".map_buttons").before('<span id="error_checked_radio" style="color: red; position: absolute; left: 200px;">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_SELECT_ONE_OPTION")+"</span>")}}else{if(b("#error_checked_radio").length>0){b("#error_checked_radio").remove()}var k=b('input[name="postdanmark_pickupLocation"]:checked').val();var h=b('input[id="'+k+'"]').parent().parent();var f=b(".point_info > strong",h).html();var l=b('input[id="'+k+'"]').val(),g=b(".point_info > strong",h).html(),j=b(".postdanmark_address > .street",h).html(),e=b(".postdanmark_address > .city",h).html(),m=b(".postdanmark_address > .service_postcode",h).val();b("input[name='service_point_id']").val(l);b("input[name='service_point_id_name']").val(g);b("input[name='service_point_id_address']").val(j);b("input[name='service_point_id_city']").val(e);b("input[name='service_point_id_postcode']").val(m);b("#sp_info #sp_name").html(f+", ");b("#sp_info #sp_address").html(j+" "+e+" "+m);b("#shop_id_pacsoft").val(l+"|"+g+"|"+j+"|"+m+"|"+e);b.magnificPopup.close()}});c.on("keyup","#mapSeachBox",function(){if(b(this).val().length===4){var f=false;var e=b(this).val();b(this).attr("placeholder","SÃ¸ger, Vent venligst...");b(this).val("").attr("disabled","disabled");b.post(redSHOP.RSConfig._("SITE_URL")+"index.php?option=com_redshop&view=checkout&task=getShippingInformation&tmpl=component&plugin=PostDanmark",{zipcode:e,countryCode:"DK"},function(g){b("#mapSeachBox").attr("placeholder",Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_POSTAL_CODE")).removeAttr("disabled");if(g.length>0){service_points=b.parseJSON(g);if(startpoint){calculateDistances()}if(typeof service_points==="object"){refreshMap(service_points)}else{b("#sog_loader").replaceWith('<div style="color: red; font-weight: normal;">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_VALID_ZIP")+"</div>")}}else{b("#sog_loader").replaceWith('<div style="color: red; font-weight: normal; ">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_VALID_ZIP")+"</div>")}})}});c.on("click",".map-button-close",function(){b.magnificPopup.close()})})})(window,jQuery);function injectPostnord(){var a=jQuery('input[name="shipping_rate_id"]:checked');var b=jQuery(a).attr("onclick");if(b.search("postdanmark")!==-1){inject_button(a)}}function inject_button(b){if(redSHOP.postDanmark.useMap){if(0==jQuery("#sp_info").length){map_contents=get_map_contents();jQuery(b).parent().after('<div id="postdanmark_html_inject"><input type="button" class="btn btn-small" onclick="showForm(\'showMap\')" value="'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_CHOOSE_DELIVERY_POINT")+'"  alt="#TB_inline?width=790&amp;inlineId=showMap" id="showMap_input" /><input type="hidden" name="shop_id" id="shop_id_pacsoft" value="" /><div id="sp_info"><span id="sp_name"></span><span id="sp_address"></span></div><div id="sp_inputs"><input type="hidden" name="service_point_id" value="" /><input type="hidden" name="service_point_id_name" value="" /><input type="hidden" name="service_point_id_address" value="" /><input type="hidden" name="service_point_id_city" value="" /><input type="hidden" name="service_point_id_postcode" value="" /></div>'+map_contents+"</div>");getShippingZipcodeAjax()}}else{if(0==jQuery("#postdanmark_html_inject").length){var a='<input name="shop_id" id="mapMobileSeachBox" type="hidden" placeholder="'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_POSTAL_CODE")+'" maxlength="4">';jQuery(b).parent().after('<div id="postdanmark_html_inject">'+a+"</div>");redSHOP.postDanmark.loadLocationMobile(b)}}}redSHOP.postDanmark.loadLocationMobile=function(a){jQuery("#mapMobileSeachBox").select2({ajax:{url:redSHOP.RSConfig._("SITE_URL")+"index.php?option=com_redshop&view=checkout&task=getShippingInformation&tmpl=component&plugin=PostDanmark",dataType:"json",delay:250,data:function(b,c){return{zipcode:b,countryCode:"DK"}},results:function(f,e){var d=[];for(i=0;i<f.addresses.length;i++){var b='<div class="row-fluid"><div class="span10">';b+="<div>"+f.name[i]+"</div>";b+="<div>"+f.city[i]+" "+f.postalCode[i]+"</div>";b+="<div>"+f.addresses[i]+"</div>";b+="</div></div>";var c={id:f.servicePointId[i]+"|"+f.name[i]+"|"+f.addresses[i]+"|"+f.postalCode[i]+"|"+f.city[i],text:b,name:f.name[i],poingId:f.servicePointId[i],addresses:f.addresses[i],postalCode:f.postalCode[i],city:f.city[i]};d.push(c)}return{results:d}},cache:true},escapeMarkup:function(b){return b},containerCssClass:"span4",minimumInputLength:4})};function refreshMap(a){if(a.name.length>0){initMap(a.addresses,a.name,a.number,a.opening,a.close,a.opening_sat,a.close_sat,a.lat,a.lng,a.servicePointId);jQuery("#postdanmark_list").html(a.radio_html)}}function getShippingZipcodeAjax(){jQuery.post(redSHOP.RSConfig._("SITE_URL")+"index.php?option=com_redshop&view=account_shipto&task=addshipping&return=checkout&tmpl=component&for=true&infoid="+jQuery('input[name="users_info_id"]:checked').val()+"&Itemid=1",function(a){var b=jQuery("#zipcode_ST",a).val();getZipcodeAjax(b)})}function getZipcodeAjax(a){jQuery.post(redSHOP.RSConfig._("SITE_URL")+"index.php?option=com_redshop&view=checkout&task=getShippingInformation&tmpl=component&plugin=PostDanmark",{zipcode:a,countryCode:"DK"},function(b){if(b.length>0){service_points=jQuery.parseJSON(b);if(startpoint){calculateDistances()}if(typeof service_points==="object"){refreshMap(service_points)}else{jQuery("#sog_loader").replaceWith('<div style="color: red; font-weight: normal;">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_VALUD_ZIP_CODE")+"</div>")}}else{jQuery("#sog_loader").replaceWith('<div style="color: red; font-weight: normal; ">'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_VALUD_ZIP_CODE")+"</div>")}})}function get_map_contents(){var a='<meta name="viewport" content="initial-scale=1.0, user-scalable=no">';a+='<div id="showMap" class="white-popup mfp-hide">';a+='    <span id="mapMessage"></span>';a+='    <input type="text" id="mapSeachBox" maxlength="4" placeholder="'+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_ENTER_POSTAL_CODE")+'" />';a+='    <img src="'+redSHOP.RSConfig._("SITE_URL")+'plugins/redshop_shipping/postdanmark/includes/images/postdanmark-logo.png" id="pd-logo"/>';a+='    <div id="map_canvas" style="height: 350px; width: 780px; position: relative; margin-top: 20px;"></div>';a+='    <div id="pickupLocations" class="pickupLocation-container">';a+='        <div class="map_buttons">';a+='        <div class="map-button-save">';a+="            <span>";a+="                <span>"+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_OK")+"</span>";a+="            </span>";a+="        </div>";a+='        <div class="map-button-close">';a+="            <span>";a+="                <span>"+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_CANCEL")+"</span>";a+="            </span>";a+="        </div>";a+="    </div>";a+='        <div id="postdanmark_list"></div>';a+='        <div class="clear"></div>';a+='    <div class="map_buttons">';a+='        <div class="map-button-save" style="margin-left: 10px;">';a+="            <span>";a+="                <span>"+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_OK")+"</span>";a+="            </span>";a+="        </div>";a+='        <div class="map-button-close">';a+="            <span>";a+="                <span>"+Joomla.JText._("PLG_REDSHOP_SHIPPING_POSTDANMARK_CANCEL")+"</span>";a+="            </span>";a+="        </div>";a+="    </div>";a+="    </div>";a+="</div>";return a}function validate_postdanmark(){if(typeof jQuery('input[name="service_point_id"]').val()!="undefined"){if(jQuery('input[name="service_point_id"]').val()==""){return false}}return true}function showForm(b){if(b==="showMap"){jQuery.magnificPopup.open({items:{src:jQuery("#showMap")},type:"inline",enableEscapeKey:false,modal:true,showCloseBtn:false,callbacks:{open:function(){initMap(service_points.addresses,service_points.name,service_points.number,service_points.opening,service_points.close,service_points.opening_sat,service_points.close_sat,service_points.lat,service_points.lng,service_points.servicePointId)}}},0);var a=jQuery.magnificPopup.instance}}function checkPDinput(a){var b=jQuery(a).get(0).getAttribute("onclick");if(b.length>1&&b.match(/'postdanmark'/)!=null){return true}return false};